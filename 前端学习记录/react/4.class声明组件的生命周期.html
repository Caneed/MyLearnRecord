<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="../../../lib/react.development.js"></script>
    <script src="../../../lib/react-dom.development.js"></script>
    <script src="../../../lib/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
  </body>
  <script type="text/babel">
    class Acom extends React.Component {
      // 构造
      constructor(props) {
        console.log("constructor");
        super(props);
        this.state = {
          age: 0,
        };
      }

      // 渲染DOM之前调用的函数
      static getDerivedStateFromProps(props, state) {
        console.log("调用getDerivedStateFromProps");
        return { age: state.age + 1 }; //返回一个新的状态
      }

      // 渲染
      render() {
        console.log("调用render");
        return (
          <div>{this.state.age}
            <button onClick={this.clickHandler.bind(this)}>+</button></div>
        );
      }

      // 事件绑定函数
      clickHandler() {
        this.setState((state) => ({
          age: state.age + 1
        }));
      }

      // 完成挂载的函数
      componentDidMount() {
        console.log("调用componentDidMount");
      }

      // 更新时的判断函数
      shouldComponentUpdate(props, state) {
        console.log("shouldComponentUpdate");
        // return false//false表示不允许更新组件
        return true; //允许更新
      }

      // 获取更新快照
      // 保存了更新前的状态和props
      getSnapShotBeforeUpdate(prevProps, prevState) {
        console.log('getSnapShotBeforeUpdate');

        // 返回一个快照对象
        return {};
      }

      // 组件更新完成
      // 第三个参数snapshot为获取更新快照函数的返回值
      componentDidUpdate(prevProps, prevState, snapshot) {
        console.log('componentDidUpdate');
      }

      // 组件被卸载前调用的函数
      componentWillUnmount() {
        console.log('componentWillUnmount');
        // 一般用来卸载全局事件
        window.removeEventListener("", () => {});
      }
    }

    ReactDOM.createRoot(document.querySelector("#root")).render(<Acom />);
  </script>
</html>
