# TCP/UDP

[TOC]

### TCP三次握手

1. 第一次握手:建立连接时,客户端发送syn包(syn=j)到服务器,并进入`SYN-SEND`状态,等服务器确认.(SYN:同步序列编号)
2. 第二次握手:服务器接收并确认到客户的syn包(ack=j+1),同时自己也发出一个syn包(syn=j)也就是SYN+ACK包,此时客户端进入到`SYN_RECV`状态
3. 第三次握手:客户端收到服务器的SYN+ACK包,向服务器发送确认包ACK,此包发送完毕时客户端和服务器同时进入ESTABLISHED(TCP)连接成功,完成三次握手

**握手时传的包中不含有数据,在三次握手完成之后客户端和服务器端才会正式传输数据**

### TCP/IP如何保证数据包传输的可靠

对字节流分段并进行编号然后通过ACK回复和超时重发这两个机制来保证

1. 为了保证数据包发送的准确性,发送方必须把发送的数据包存到缓存区
2. 并为每个数据包设置一个超时定时器
3. 如在定时器超时之前收到了对方发来的应答信息（可能是对本包的应答，也可以是对本包后续包的应答），则释放该数据包占用的缓冲区
4. 否则就重发此数据包直到收到应答或重传次数超过规定的最大次数为止。
5. 接收方收到数据包后，先进行CRC校验，如果正确则把数据交给上层协议，然后给发送方发送一个累计应答包，表明该数据已收到，如果接收方正好也有数据要发给发送方，应答包也可方在数据包中捎带过去。

### TCP和UDP的区别

1. TCP是面向连接的,UDP是面向无连接的
2. TCP仅支持单播传输,UDP提供了单播,多播,广播的功能
3. TCP的三次握手保证了连接的可靠性; UDP是无连接的、不可靠的一种数据传输协议，首先不可靠性体现在无连接上，通信都不需要建立连接，对接收到的数据也不发送确认信号，发送端不知道数据是否会正确接收。
4. UDP的头部开销要比TCP要小数据传输速率更高,实时性更好
